<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Divine Yazatas | Zoroastrian Heritage</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Fonts: Cinzel, Lato, and Vazirmatn (for Persian) -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=Lato:wght@300;400;700&family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'cinzel': ['Cinzel', 'serif'],
                        'lato': ['Lato', 'sans-serif'],
                        'persian': ['Vazirmatn', 'sans-serif'],
                    },
                    colors: {
                        'persian-gold': '#D4AF37',
                        'persian-blue': '#1a5f7a',
                        'deep-rose': '#be123c',
                        'royal-purple': '#7e22ce',
                        'sand': '#fdfcf8',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #fdfcf8;
            background-image: 
                linear-gradient(rgba(212, 175, 55, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(212, 175, 55, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }
        
        /* Smooth Fade In */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Gender Gradients for Card Borders */
        .border-gradient-male { background: linear-gradient(to right, #0ea5e9, #2563eb); }
        .border-gradient-female { background: linear-gradient(to right, #fb7185, #e11d48); }
        .border-gradient-neutral { background: linear-gradient(to right, #fbbf24, #d97706); }
        .border-gradient-plural { background: linear-gradient(to right, #c084fc, #9333ea); }

        /* Tooltip Logic */
        .tooltip-container:hover .tooltip-content,
        .tooltip-container:focus-within .tooltip-content {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        /* Loading Spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #D4AF37;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="font-lato text-gray-700 min-h-screen flex flex-col antialiased">
    
    <!-- Motto Bar -->
    <div class="bg-gray-900 border-b border-gray-800">
        <div class="container mx-auto px-4 py-2.5 text-center">
            <p class="text-[10px] md:text-xs font-cinzel font-bold tracking-[0.3em] text-persian-gold uppercase">
                Good Thoughts <span class="mx-2 text-gray-600">•</span> Good Words <span class="mx-2 text-gray-600">•</span> Good Deeds
            </p>
        </div>
    </div>
    
    <!-- Hero / Header -->
    <header class="sticky top-0 z-50 transition-all duration-300 backdrop-blur-md bg-white/80 border-b border-stone-200 shadow-sm">
        <div class="h-1 w-full bg-gradient-to-r from-transparent via-persian-gold to-transparent opacity-70"></div>
        <div class="container mx-auto px-6 py-4">
            <div class="flex flex-col md:flex-row justify-between items-center gap-5">
                
                <!-- Brand & Tooltip -->
                <div class="flex items-center gap-4 group cursor-default w-full md:w-auto justify-center md:justify-start">
                    <div class="relative flex-shrink-0">
                        <div class="absolute -inset-1 rounded-full bg-gradient-to-r from-amber-300 to-orange-400 opacity-30 blur group-hover:opacity-50 transition duration-500"></div>
                        <div class="relative w-12 h-12 bg-white rounded-full flex items-center justify-center border border-amber-100 shadow-sm">
                            <i class="fa-solid fa-fire text-amber-600 text-xl"></i>
                        </div>
                    </div>
                    
                    <div class="relative">
                        <div class="flex items-baseline gap-2">
                            <h1 class="text-2xl font-cinzel font-bold text-gray-800 tracking-wide uppercase">Yazatas</h1>
                            
                            <!-- Custom Tooltip Trigger -->
                            <div class="tooltip-container relative inline-block group/tooltip" tabindex="0">
                                <i class="fa-solid fa-circle-info text-amber-400/80 hover:text-amber-600 cursor-help text-sm transition-colors"></i>
                                
                                <!-- Tooltip Content -->
                                <div class="tooltip-content absolute right-[-10px] md:right-auto md:left-0 top-full mt-3 w-72 md:w-96 p-4 bg-gray-900 text-stone-200 text-xs leading-relaxed rounded-xl shadow-2xl border border-gray-700 opacity-0 invisible transform -translate-y-2 transition-all duration-300 z-50 pointer-events-none group-hover/tooltip:pointer-events-auto">
                                    <div class="absolute -top-1.5 right-4 md:right-auto md:left-4 w-3 h-3 bg-gray-900 border-l border-t border-gray-700 transform rotate-45"></div>
                                    <p class="font-serif italic text-amber-500 mb-1">Definition:</p>
                                    In the Zoroastrian religion, the <span class="text-white font-bold">Yazatas</span> (Avestan for 'worthy of worship' or 'venerable beings') are a group of divine beings created by Ahura Mazda to help maintain world order (Asha) and fight against the forces of evil.
                                </div>
                            </div>
                        </div>
                        <p class="text-[10px] text-amber-700 font-bold uppercase tracking-[0.2em]">Zoroastrian Divinity</p>
                    </div>
                </div>
                
                <!-- Search -->
                <div class="relative w-full md:w-96 group">
                    <div class="absolute -inset-0.5 rounded-full bg-gradient-to-r from-gray-200 to-gray-300 opacity-50 blur transition duration-300 group-hover:opacity-75 group-focus-within:opacity-100 group-focus-within:from-amber-300 group-focus-within:to-orange-300"></div>
                    <div class="relative bg-white rounded-full flex items-center shadow-sm">
                        <i class="fa-solid fa-search text-gray-400 ml-4"></i>
                        <input type="text" id="searchInput" placeholder="Search by name, role, or meaning..." 
                               class="w-full px-4 py-2.5 rounded-full bg-transparent focus:outline-none text-gray-700 placeholder-gray-400 text-sm">
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Section -->
    <main class="container mx-auto px-4 py-8 flex-grow">
        
        <!-- Tabs Navigation -->
        <div class="flex justify-center mb-10">
            <div class="bg-white/60 backdrop-blur-sm p-1.5 rounded-full shadow-inner border border-stone-100 inline-flex overflow-x-auto max-w-full space-x-1 min-h-[50px]" id="categoryContainer">
                <!-- Tabs injected JS -->
            </div>
        </div>

        <!-- Description -->
        <div id="categoryDescription" class="mb-10 max-w-3xl mx-auto text-center hidden fade-in">
            <div class="relative px-8 py-6 bg-white rounded-2xl shadow-sm border border-stone-100">
                <i class="fa-solid fa-quote-left absolute top-4 left-4 text-gray-100 text-3xl"></i>
                <p class="relative z-10 text-gray-600 italic font-serif text-lg leading-relaxed"></p>
                <i class="fa-solid fa-quote-right absolute bottom-4 right-4 text-gray-100 text-3xl"></i>
            </div>
        </div>
        
        <!-- Loading State -->
        <div id="loadingState" class="flex flex-col items-center justify-center py-24">
            <div class="loader mb-4"></div>
            <p class="text-sm font-cinzel text-gray-500 tracking-widest uppercase">Loading Archives...</p>
        </div>

        <!-- Cards Grid -->
        <div id="cardsGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8 hidden">
            <!-- Cards injected by JS -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden text-center py-24 fade-in">
            <div class="inline-block p-6 rounded-full bg-gray-50 mb-4">
                <i class="fa-solid fa-scroll text-4xl text-gray-300"></i>
            </div>
            <h3 class="text-xl text-gray-500 font-cinzel font-semibold">No divinities found in the archives.</h3>
            <p class="text-gray-400 text-sm mt-2">Try adjusting your search terms.</p>
        </div>

    </main>

    <!-- Pagination -->
    <div class="bg-white/80 backdrop-blur border-t border-stone-200 py-6 mt-auto">
        <div class="container mx-auto px-4 flex justify-center items-center gap-6">
            <button id="prevBtn" class="group flex items-center gap-2 px-5 py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 hover:border-amber-400 hover:text-amber-700 disabled:opacity-40 disabled:hover:border-gray-200 disabled:hover:text-gray-600 transition-all shadow-sm">
                <i class="fa-solid fa-arrow-left text-xs transition-transform group-hover:-translate-x-1"></i> 
                <span class="font-cinzel font-semibold text-sm">Previous</span>
            </button>
            
            <div class="flex items-center gap-2 font-cinzel text-gray-800 font-bold bg-amber-50 px-4 py-1 rounded-lg border border-amber-100">
                <span id="pageIndicator">1 / 1</span>
            </div>

            <button id="nextBtn" class="group flex items-center gap-2 px-5 py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 hover:border-amber-400 hover:text-amber-700 disabled:opacity-40 disabled:hover:border-gray-200 disabled:hover:text-gray-600 transition-all shadow-sm">
                <span class="font-cinzel font-semibold text-sm">Next</span>
                <i class="fa-solid fa-arrow-right text-xs transition-transform group-hover:translate-x-1"></i>
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 py-10 border-t-4 border-persian-gold">
        <div class="container mx-auto text-center space-y-4">
            <div class="flex justify-center gap-4 mb-4">
                <i class="fa-solid fa-star text-xs text-amber-700"></i>
                <i class="fa-solid fa-star text-sm text-amber-600"></i>
                <i class="fa-solid fa-star text-xs text-amber-700"></i>
            </div>
            <p class="text-sm font-cinzel tracking-wider text-gray-300">Good Thoughts, Good Words, Good Deeds</p>
            <p class="text-xs opacity-50 font-lato">Honoring the heritage of Ancient Iran</p>
        </div>
    </footer>

    <!-- Logic -->
    <script>
        // --- 1. State & Setup ---
        let currentCategory = 'All';
        let searchQuery = '';
        let currentPage = 1;
        const itemsPerPage = 9;
        
        // Data containers to be populated via fetch
        let allEntities = [];
        let categories = []; 
        let globalIdCounter = 1;

        // --- 2. Data Fetching ---
        async function initData() {
            const loadingState = document.getElementById('loadingState');
            const grid = document.getElementById('cardsGrid');
            const categoryContainer = document.getElementById('categoryContainer');

            try {
                // Fetch external JSON
                const response = await fetch('https://vohuman.github.io/yazatas/data.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const rawData = await response.json();
                categories = rawData.zoroastrian_yazatas;
                
                // Process Data
                categories.forEach(cat => {
                    cat.entities.forEach(ent => {
                        allEntities.push({
                            ...ent,
                            id: globalIdCounter++,
                            categoryRef: cat.category,
                            suppress_image: ent.name_avestan === "Ahura Mazda"
                        });
                    });
                });

                // Hide loading, show UI
                loadingState.classList.add('hidden');
                grid.classList.remove('hidden');

                // Initialize UI components
                createCategoryTabs();
                render();

            } catch (error) {
                console.error("Error loading Yazatas data:", error);
                loadingState.innerHTML = `
                    <div class="text-center text-gray-500">
                        <i class="fa-solid fa-triangle-exclamation text-4xl mb-4 text-amber-500"></i>
                        <h3 class="text-xl font-cinzel font-bold">Unable to retrieve archives.</h3>
                        <p class="text-sm mt-2">Please check your internet connection.</p>
                        <button onclick="initData()" class="mt-4 px-4 py-2 bg-stone-100 hover:bg-stone-200 rounded-full text-xs font-bold uppercase transition-colors">Try Again</button>
                    </div>
                `;
            }
        }

        // --- 3. UI Helpers ---

        function getGenderTheme(gender) {
            const g = (gender || "").toLowerCase();
            
            if (g.includes('plural') || g.includes('neutral')) {
                return {
                    borderClass: 'border-gradient-plural',
                    badgeBg: 'bg-purple-50',
                    badgeText: 'text-purple-700',
                    badgeBorder: 'border-purple-200',
                    icon: 'fa-users',
                    shadow: 'hover:shadow-purple-100'
                };
            }
            else if (g.includes('female')) {
                return {
                    borderClass: 'border-gradient-female',
                    badgeBg: 'bg-rose-50',
                    badgeText: 'text-rose-700',
                    badgeBorder: 'border-rose-200',
                    icon: 'fa-venus',
                    shadow: 'hover:shadow-rose-100'
                };
            } 
            else if (g.includes('male') && !g.includes('female')) { 
                return {
                    borderClass: 'border-gradient-male',
                    badgeBg: 'bg-sky-50',
                    badgeText: 'text-sky-700',
                    badgeBorder: 'border-sky-200',
                    icon: 'fa-mars',
                    shadow: 'hover:shadow-sky-100'
                };
            } 
            else {
                return {
                    borderClass: 'border-gradient-neutral',
                    badgeBg: 'bg-amber-50',
                    badgeText: 'text-amber-700',
                    badgeBorder: 'border-amber-200',
                    icon: 'fa-gem',
                    shadow: 'hover:shadow-amber-100'
                };
            }
        }

        function createCategoryTabs() {
            const container = document.getElementById('categoryContainer');
            container.innerHTML = ''; // Clear potentially stale tabs

            // "All" Button
            const allBtn = document.createElement('button');
            allBtn.dataset.cat = 'All';
            allBtn.className = `px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 font-cinzel ${currentCategory === 'All' ? 'bg-gray-800 text-white shadow-md' : 'bg-transparent text-gray-500 hover:bg-gray-100'}`;
            allBtn.textContent = 'All';
            allBtn.onclick = () => setCategory('All');
            container.appendChild(allBtn);

            // Category Buttons
            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.dataset.cat = cat.category;
                const isActive = currentCategory === cat.category;
                
                // Shorten name logic for display tabs
                let displayName = cat.category;
                if(displayName.includes('Amesha Spentas')) displayName = 'Amesha Spentas';
                if(displayName.includes('Nature')) displayName = 'Nature';
                if(displayName.includes('Time')) displayName = 'Time/Gahs';
                if(displayName.includes('Moral')) displayName = 'Concepts';
                if(displayName.includes('Protection')) displayName = 'Protection';
                if(displayName.includes('Liturgical')) displayName = 'Social';
                if(displayName.includes('Spiritual Forces')) displayName = 'Forces';
                if(displayName.includes('Agriculture')) displayName = 'Agriculture';
                if(displayName.includes('Star')) displayName = 'Stars';
                if(displayName.includes('Great Fires')) displayName = 'Fires';

                btn.className = `px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 whitespace-nowrap font-cinzel ${isActive ? 'bg-persian-gold text-white shadow-md' : 'bg-transparent text-gray-500 hover:bg-gray-100'}`;
                btn.textContent = displayName;
                btn.onclick = () => setCategory(cat.category);
                container.appendChild(btn);
            });
        }

        // --- 4. Logic Functions ---

        // Video Handlers
        function playVideo(container) {
            const video = container.querySelector('video');
            if (video) {
                video.style.opacity = '1';
                video.play().catch(e => console.log('Autoplay blocked:', e));
            }
        }

        function stopVideo(container) {
            const video = container.querySelector('video');
            if (video) {
                video.style.opacity = '0';
                video.pause();
                video.currentTime = 0;
            }
        }

        function setCategory(catName) {
            currentCategory = catName;
            currentPage = 1;
            updateCategoryTabsUI();
            updateCategoryDescription();
            render();
        }

        function updateCategoryTabsUI() {
            const buttons = document.getElementById('categoryContainer').children;
            Array.from(buttons).forEach(btn => {
                if (btn.dataset.cat === currentCategory) {
                    btn.className = currentCategory === 'All' 
                        ? 'px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 font-cinzel bg-gray-800 text-white shadow-md transform scale-105'
                        : 'px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 whitespace-nowrap font-cinzel bg-persian-gold text-white shadow-md transform scale-105';
                } else {
                    btn.className = 'px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 whitespace-nowrap font-cinzel bg-transparent text-gray-500 hover:bg-gray-50';
                }
            });
        }

        function updateCategoryDescription() {
            const descBox = document.getElementById('categoryDescription');
            const descText = descBox.querySelector('p');
            
            if (currentCategory === 'All' || searchQuery !== '') {
                descBox.classList.add('hidden');
                return;
            }
            
            const catData = categories.find(c => c.category === currentCategory);
            if (catData && catData.description) {
                descText.textContent = catData.description;
                descBox.classList.remove('hidden');
            }
        }

        function filterData() {
            let data = currentCategory === 'All' 
                ? allEntities 
                : allEntities.filter(e => e.categoryRef === currentCategory);

            if (searchQuery) {
                const lowerQ = searchQuery.toLowerCase();
                data = data.filter(e => 
                    e.name_avestan.toLowerCase().includes(lowerQ) ||
                    e.alias_persian.toLowerCase().includes(lowerQ) ||
                    e.complete_meaning.toLowerCase().includes(lowerQ) ||
                    e.role.toLowerCase().includes(lowerQ) ||
                    e.guardian_of.toLowerCase().includes(lowerQ)
                );
            }
            return data;
        }

        function renderCard(entity) {
            const theme = getGenderTheme(entity.gender);
            // Check for non-empty video URL
            const hasVideo = entity.video_url && entity.video_url.trim().length > 0;
            
            // Image Logic
            let imageSectionHtml = '';
            
            if (!entity.suppress_image) {
                let innerContent = '';
                
                // Specific override for Dahman Afrin and Fravashi to handle taller/wider images
                const heightClass = (entity.name_avestan === 'Dahman Afrin' || entity.name_avestan === 'Fravashi') ? 'h-64' : 'h-40';

                // Base Image Content
                if (Array.isArray(entity.image_url) && entity.image_url.length > 1) {
                     innerContent = `
                        <div class="relative w-full h-full group/image z-10">
                            <!-- Bottom Image (Revealed on Hover) -->
                            <img src="${entity.image_url[1]}" alt="${entity.name_avestan} Alternate" class="absolute inset-0 w-full h-full object-cover">
                            <!-- Top Image (Hidden on Hover) -->
                            <img src="${entity.image_url[0]}" alt="${entity.name_avestan}" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ease-in-out opacity-100 group-hover/image:opacity-0">
                        </div>
                    `;
                } else {
                    // Single Image
                    const imgSrc = Array.isArray(entity.image_url) ? entity.image_url[0] : entity.image_url;
                    
                    innerContent = imgSrc 
                        ? `<img src="${imgSrc}" alt="${entity.name_avestan}" class="w-full h-full object-cover relative z-10 block">`
                        : `<div class="w-full h-full flex flex-col items-center justify-center text-stone-300 bg-stone-50 relative z-10">
                                <i class="fa-solid fa-image text-2xl mb-2 opacity-50"></i>
                                <span class="text-[10px] font-cinzel uppercase tracking-widest opacity-50">Image Pending</span>
                           </div>`;
                }

                // Video Logic
                let videoOverlay = '';
                let containerProps = '';
                let indicator = '';

                if (hasVideo) {
                    // Visual Indicator
                    indicator = `
                        <div class="absolute top-2 right-2 z-30 bg-black/60 backdrop-blur-md rounded-full w-6 h-6 flex items-center justify-center border border-white/20 shadow-lg pointer-events-none">
                            <i class="fa-solid fa-play text-[8px] text-white ml-0.5"></i>
                        </div>
                    `;
                    
                    // Video Element - Force opacity 0, Z-50 (top), black bg
                    videoOverlay = `
                        <video 
                            src="${entity.video_url}" 
                            class="absolute inset-0 w-full h-full object-cover z-50 opacity-0 transition-opacity duration-300 bg-black pointer-events-none" 
                            muted loop playsinline preload="auto">
                        </video>
                    `;
                    
                    // Add listeners to wrapper
                    containerProps = `onmouseenter="playVideo(this)" onmouseleave="stopVideo(this)"`;
                }
                
                imageSectionHtml = `
                    <div class="w-full ${heightClass} mb-5 bg-stone-50 rounded-xl border border-stone-100 overflow-hidden relative group-hover:shadow-md transition-shadow" ${containerProps}>
                        ${innerContent}
                        ${videoOverlay}
                        ${indicator}
                    </div>`;
            }
            
            return `
            <div class="group relative bg-white rounded-2xl shadow-[0_4px_20px_rgb(0,0,0,0.03)] border border-stone-100 overflow-hidden flex flex-col h-full transition-all duration-300 hover:-translate-y-1 hover:shadow-xl ${theme.shadow} fade-in">
                
                <!-- Top Gradient Border -->
                <div class="h-1.5 w-full ${theme.borderClass}"></div>
                
                <div class="p-7 flex flex-col flex-grow relative z-10">
                    
                    <!-- Image Area (Conditional) -->
                    ${imageSectionHtml}

                    <!-- Header -->
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-grow pr-4">
                            <span class="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-md text-[10px] font-bold uppercase tracking-wider mb-3 border ${theme.badgeBg} ${theme.badgeText} ${theme.badgeBorder}">
                                <i class="fa-solid ${theme.icon}"></i> ${entity.gender.split(' ')[0]}
                            </span>
                            <h3 class="text-2xl font-cinzel font-bold text-gray-800 leading-none mb-1">${entity.name_avestan}</h3>
                            <p class="text-xs font-semibold text-gray-400 uppercase tracking-wide">${entity.alias_persian}</p>
                        </div>
                        <!-- Persian Script with Golden Hover Glow -->
                        <div class="text-2xl font-persian text-gray-400 group-hover:text-persian-gold transition-all duration-500 group-hover:[text-shadow:0_0_10px_#D4AF37,0_0_20px_rgba(212,175,55,0.4)] cursor-default" dir="rtl">
                            ${entity.persian_script}
                        </div>
                    </div>
                    
                    <!-- Meaning -->
                    <div class="mb-5">
                        <p class="text-lg font-serif italic text-gray-600">"${entity.complete_meaning}"</p>
                        <div class="w-12 h-0.5 bg-amber-200 mt-3 rounded-full"></div>
                    </div>

                    <!-- Details -->
                    <div class="space-y-3 text-sm text-gray-600 flex-grow leading-relaxed">
                        <div class="flex gap-2">
                            <i class="fa-solid fa-crown text-amber-600/70 mt-1 text-xs"></i>
                            <div><strong class="text-gray-900 block text-xs uppercase tracking-wide opacity-70 mb-0.5">Divine Role</strong>${entity.role}</div>
                        </div>
                        <div class="flex gap-2">
                            <i class="fa-solid fa-shield-halved text-amber-600/70 mt-1 text-xs"></i>
                            <div><strong class="text-gray-900 block text-xs uppercase tracking-wide opacity-70 mb-0.5">Guardian Of</strong>${entity.guardian_of}</div>
                        </div>
                    </div>
                </div>
                
                <!-- Footer strip -->
                <div class="bg-stone-50/50 px-6 py-3 border-t border-stone-100 flex justify-end items-center">
                   <i class="fa-solid fa-feather text-stone-200 group-hover:text-amber-400 transition-colors"></i>
                </div>
            </div>
            `;
        }

        function render() {
            const filtered = filterData();
            const grid = document.getElementById('cardsGrid');
            const emptyState = document.getElementById('emptyState');
            const pageIndicator = document.getElementById('pageIndicator');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            // Pagination
            const totalPages = Math.ceil(filtered.length / itemsPerPage) || 1;
            
            if (currentPage > totalPages) currentPage = totalPages;
            if (currentPage < 1) currentPage = 1;

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filtered.slice(startIndex, endIndex);

            // Render Grid
            grid.innerHTML = '';
            
            if (filtered.length === 0) {
                emptyState.classList.remove('hidden');
                grid.classList.add('hidden');
            } else {
                emptyState.classList.add('hidden');
                grid.classList.remove('hidden');
                pageData.forEach(entity => {
                    grid.innerHTML += renderCard(entity);
                });
            }

            // Controls
            pageIndicator.textContent = `${currentPage} / ${totalPages}`;
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages || filtered.length === 0;
            
            // Style disabled buttons
            [prevBtn, nextBtn].forEach(btn => {
                if(btn.disabled) {
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                    btn.classList.remove('hover:border-amber-400', 'hover:text-amber-700');
                } else {
                    btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    btn.classList.add('hover:border-amber-400', 'hover:text-amber-700');
                }
            });
        }

        // --- 5. Listeners ---

        document.getElementById('searchInput').addEventListener('input', (e) => {
            searchQuery = e.target.value.trim();
            currentPage = 1;
            updateCategoryDescription();
            render();
        });

        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                render();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            const filtered = filterData();
            const totalPages = Math.ceil(filtered.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                render();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        // --- 6. Initialization ---
        // Start by fetching data
        initData();

    </script>
</body>
</html>
